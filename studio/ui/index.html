<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/jerosoler/Drawflow/dist/drawflow.min.css">
    <script src="https://cdn.jsdelivr.net/gh/jerosoler/Drawflow/dist/drawflow.min.js"></script>
    <!-- ADDED: Markdown parsing library -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <title>XronAI Studio</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <!-- ADDED: Global loading overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="spinner"></div>
        <p id="loading-message">Compiling workflow...</p>
    </div>

    <div class="studio-container">
        <header class="studio-header">
            <div class="logo-container">
                <img src="/assets/studio-logo.png" alt="XronAI Logo" class="header-logo">
                <h1>Studio</h1>
            </div>
            <div class="header-actions">
                 <!-- ADDED: Theme toggle button -->
                <button id="theme-toggle-btn" class="icon-btn" title="Toggle Theme">
                    <svg id="theme-icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="theme-icon"><path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.106a.75.75 0 010 1.06l-1.591 1.59a.75.75 0 01-1.06-1.06l1.59-1.59a.75.75 0 011.06 0zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.894 17.894a.75.75 0 011.06 0l1.59 1.591a.75.75 0 01-1.06 1.06l-1.59-1.59a.75.75 0 010-1.061zM12 18a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.106 17.894a.75.75 0 010-1.06l-1.59-1.591a.75.75 0 01-1.061 1.06l1.59 1.59a.75.75 0 011.06 0zM3 12a.75.75 0 01.75-.75h2.25a.75.75 0 010 1.5H3.75A.75.75 0 013 12zM6.106 7.106a.75.75 0 011.06 0l1.591-1.59a.75.75 0 01-1.06-1.06l-1.59 1.59a.75.75 0 010 1.06z"></path></svg>
                    <svg id="theme-icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="theme-icon" style="display: none;"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 004.463-.949a.75.75 0 01.82.162a10.503 10.503 0 01-1.393 4.133c-.39.79-.863 1.503-1.425 2.125a10.46 10.46 0 01-2.885 2.191A10.503 10.503 0 0112 22.5c-5.798 0-10.5-4.702-10.5-10.5 0-2.25.713-4.354 1.936-6.136A10.499 10.499 0 019.528 1.718z" clip-rule="evenodd"></path></svg>
                </button>
                <button id="export-workflow-btn" class="export-btn">Export as YAML</button>
                <div class="mode-switcher">
                    <button id="edit-workflow-btn" class="active">Design</button>
                    <button id="start-chat-btn">Chat</button>
                </div>
            </div>
        </header>

        <main class="studio-main-content">
            <div class="workspace-panel">
                <aside class="icon-toolbar">
                    <button id="add-supervisor-btn" title="Add Supervisor">S</button>
                    <button id="add-agent-btn" title="Add Agent">A</button>
                    <button id="add-user-btn" title="Add User">U</button>
                    <button id="add-tool-btn" title="Add Built-in Tool">T</button>
                    <button id="add-mcp-btn" title="Add MCP Server">M</button>
                </aside>
                <section class="canvas" id="drawflow"></section>
            </div>

            <div class="resizer" data-direction="vertical"></div>

            <section class="contextual-panel">
                <div class="configuration-view">
                     <div class="panel-placeholder">
                        <h2>Configuration</h2>
                        <p>Click a node on the canvas to configure its properties here.</p>
                    </div>
                </div>
                <div class="chat-view">
                    <div id="log" class="log-container"></div>
                    <footer class="chat-footer">
                        <form id="form" class="chat-form">
                             <!-- CHANGED: to textarea for multi-line support -->
                            <textarea id="input" placeholder="Type your message... (Shift+Enter for new line)" rows="1"></textarea>
                            <button type="submit" title="Send Message">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="send-icon"><path d="M3.105 3.105a.75.75 0 01.814-.148L19.427 9.25a.75.75 0 010 1.5L3.92 17.043a.75.75 0 01-1.037-.623V13.5a.75.75 0 01.528-.713l8.2-2.522a.75.75 0 000-1.33L4.45 6.213A.75.75 0 013.92 5.5v-2.25a.75.75 0 01.186-.545z" /></svg>
                            </button>
                        </form>
                    </footer>
                </div>
            </section>
        </main>
    </div>

    <div id="add-tool-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>Select a Tool</h2>
            <div id="tool-list" class="tool-list-container">
            </div>
            <button id="close-tool-modal-btn" class="modal-close-btn">Cancel</button>
        </div>
    </div>

    <script src="/app.js"></script>
</body>
</html>